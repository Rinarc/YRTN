<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YRTN SHORT</title>
    <!-- ÂºïÂÖ•Â≠ó‰ΩìÂõæÊ†á -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #fe2c55;
            --secondary-color: #25f4ee;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: #000;
            font-family: -apple-system, sans-serif;
            overflow: hidden;
        }

        /* ËßÜÈ¢ëÂÆπÂô® */
        .video-container {
            position: relative;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
        }

        /* Âçï‰∏™ËßÜÈ¢ëÂÖÉÁ¥† */
        .video-item {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            opacity: 0;
            transition: transform 0.8s cubic-bezier(0.22, 1, 0.36, 1);
            transform: translateY(100%);
            background: #000; /* Âä†ËΩΩÊó∂ËÉåÊôØ */
        }

        .video-item.active {
            opacity: 1;
            transform: translateY(0);
        }

        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* ËßÜÈ¢ë‰ø°ÊÅØÂ±Ç */
        .video-info {
            position: absolute;
            bottom: 80px;
            left: 15px;
            color: white;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
            max-width: 70%;
            z-index: 2;
        }

        .author {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
            border: 2px solid var(--primary-color);
        }

        /* Âè≥‰æßÊìç‰ΩúÊ†è */
        .action-bar {
            position: absolute;
            right: 15px;
            bottom: 100px;
            display: flex;
            flex-direction: column;
            gap: 25px;
            color: white;
            z-index: 2;
        }

        .action-item {
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .action-item:hover {
            transform: scale(1.1);
        }

        .icon {
            width: 50px;
            height: 50px;
            margin-bottom: 5px;
        }

        /* Âä†ËΩΩÂä®Áîª */
        .loader {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 24px;
            z-index: 100;
        }

        /* Â£∞Èü≥ÊéßÂà∂ */
        .sound-control {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.5);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            color: white;
            cursor: pointer;
            z-index: 100;
        }
    </style>
</head>
<body>
    <div class="video-container" id="videoContainer">
        <div class="loader">üé¨ Âä†ËΩΩ‰∏≠...</div>
        <button class="sound-control" id="soundControl">
            <i class="fas fa-volume-mute"></i>
        </button>
    </div>

    <script>
        // sv.json Êï∞ÊçÆÁªìÊûÑÁ§∫‰æã
        /*
        {
            "videos": [
                {
                    "id": 1,
                    "sources": [
                        {"src": "video1.mp4", "type": "video/mp4"},
                        {"src": "video1.webm", "type": "video/webm"}
                    ],
                    "author": {
                        "name": "ÊäñÈü≥Áî®Êà∑",
                        "avatar": "avatar1.jpg",
                        "fans": "123.4‰∏á"
                    },
                    "description": "ËßÜÈ¢ëÊèèËø∞ÂÜÖÂÆπ #ÁÉ≠Èó®",
                    "stats": {
                        "likes": 12345,
                        "comments": 456,
                        "shares": 789
                    },
                    "music": "ÁÉ≠Èó®Èü≥‰πê - ‰ΩúËÄÖ"
                }
            ]
        }
        */

        class DouyinClone {
            constructor() {
                this.container = document.getElementById('videoContainer');
                this.soundControl = document.getElementById('soundControl');
                this.isMuted = true;
                this.videoQueue = [];
                this.currentIndex = 0;
                this.touchStartY = 0;

                this.init();
            }

            async init() {
                await this.loadVideos();
                this.initEventListeners();
                this.initFirstVideo();
                document.querySelector('.loader').remove();
            }

            async loadVideos() {
                try {
                    const response = await fetch('sv.json');
                    this.videoQueue = (await response.json()).videos;
                } catch (error) {
                    console.error('ËßÜÈ¢ëÂä†ËΩΩÂ§±Ë¥•:', error);
                    this.showError('ËßÜÈ¢ëÂä†ËΩΩÂ§±Ë¥•ÔºåËØ∑Âà∑Êñ∞ÈáçËØï');
                }
            }

            initFirstVideo() {
                if (this.videoQueue.length > 0) {
                    this.createVideoElement(0);
                }
            }

            createVideoElement(index) {
                const videoData = this.videoQueue[index];
                const videoWrapper = document.createElement('div');
                videoWrapper.className = 'video-item';
                
                // ËßÜÈ¢ëÂÖÉÁ¥†
                const video = document.createElement('video');
                video.playsInline = true;
                video.muted = this.isMuted;
                video.loop = true;
                
                // Â§öÊ∫êÊîØÊåÅ
                videoData.sources.forEach(source => {
                    const sourceElem = document.createElement('source');
                    sourceElem.src = source.src;
                    sourceElem.type = source.type;
                    video.appendChild(sourceElem);
                });

                // ‰ø°ÊÅØÂ±Ç
                const infoLayer = `
                    <div class="video-info">
                        <div class="author">
                            <img src="${videoData.author.avatar}" class="avatar">
                            <div>
                                <h3>${videoData.author.name}</h3>
                                <p>${videoData.author.fans}Á≤â‰∏ù</p>
                            </div>
                        </div>
                        <p>${videoData.description}</p>
                        <p>üéµ ${videoData.music}</p>
                    </div>
                    <div class="action-bar">
                        <div class="action-item" onclick="toggleLike(this)">
                            <i class="fas fa-heart icon"></i>
                            <span>${this.formatCount(videoData.stats.likes)}</span>
                        </div>
                        <div class="action-item" onclick="toggleComment()">
                            <i class="fas fa-comment icon"></i>
                            <span>${this.formatCount(videoData.stats.comments)}</span>
                        </div>
                        <div class="action-item">
                            <i class="fas fa-share icon"></i>
                            <span>${this.formatCount(videoData.stats.shares)}</span>
                        </div>
                    </div>
                `;

                videoWrapper.innerHTML = infoLayer;
                videoWrapper.prepend(video);
                this.container.appendChild(videoWrapper);

                // ËßÜÈ¢ëÂä†ËΩΩÂ§ÑÁêÜ
                video.addEventListener('loadeddata', () => {
                    videoWrapper.classList.add('active');
                    video.play().catch(error => {
                        if(error.name === 'NotAllowedError') {
                            this.showPlayButton(videoWrapper);
                        }
                    });
                });

                video.addEventListener('error', () => {
                    this.showError('ËßÜÈ¢ëÂä†ËΩΩÂ§±Ë¥•');
                });
            }

            initEventListeners() {
                // Â£∞Èü≥ÊéßÂà∂
                this.soundControl.addEventListener('click', () => {
                    this.isMuted = !this.isMuted;
                    this.soundControl.innerHTML = this.isMuted ? 
                        '<i class="fas fa-volume-mute"></i>' : 
                        '<i class="fas fa-volume-up"></i>';
                    document.querySelectorAll('video').forEach(v => v.muted = this.isMuted);
                });

                // Ëß¶Êë∏‰∫ã‰ª∂
                this.container.addEventListener('touchstart', e => {
                    this.touchStartY = e.touches[0].clientY;
                }, { passive: true });

                this.container.addEventListener('touchend', e => {
                    const deltaY = e.changedTouches[0].clientY - this.touchStartY;
                    if (Math.abs(deltaY) > 50) {
                        deltaY > 0 ? this.swipeDown() : this.swipeUp();
                    }
                });

                // ÊªöËΩÆ‰∫ã‰ª∂
                this.container.addEventListener('wheel', e => {
                    if (e.deltaY > 5) this.swipeUp();
                    else if (e.deltaY < -5) this.swipeDown();
                }, { passive: false });
            }

            swipeUp() {
                if (this.currentIndex < this.videoQueue.length - 1) {
                    this.currentIndex++;
                    this.showVideo(this.currentIndex);
                }
            }

            swipeDown() {
                if (this.currentIndex > 0) {
                    this.currentIndex--;
                    this.showVideo(this.currentIndex);
                }
            }

            showVideo(index) {
                document.querySelectorAll('.video-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                if (!this.container.children[index]) {
                    this.createVideoElement(index);
                }
                
                setTimeout(() => {
                    this.container.children[index].classList.add('active');
                }, 50);
            }

            formatCount(num) {
                return num > 10000 ? (num/10000).toFixed(1) + 'w' : num;
            }

            showError(message) {
                const errorDiv = document.createElement('div');
                errorDiv.style = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    color: white;
                    background: rgba(0,0,0,0.8);
                    padding: 20px;
                    border-radius: 10px;
                `;
                errorDiv.textContent = message;
                document.body.appendChild(errorDiv);
            }

            showPlayButton(container) {
                const playBtn = document.createElement('button');
                playBtn.style = `
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(0,0,0,0.5);
                    border: none;
                    border-radius: 50%;
                    width: 60px;
                    height: 60px;
                    color: white;
                    cursor: pointer;
                `;
                playBtn.innerHTML = '<i class="fas fa-play"></i>';
                playBtn.onclick = () => {
                    container.querySelector('video').play();
                    playBtn.remove();
                };
                container.appendChild(playBtn);
            }
        }

        // ÂàùÂßãÂåñ
        new DouyinClone();

        // ÁÇπËµûÂäüËÉΩ
        function toggleLike(btn) {
            const icon = btn.querySelector('i');
            icon.style.color = icon.style.color === 'var(--primary-color)' ? 
                '#fff' : 'var(--primary-color)';
        }
    </script>
</body>
</html>
